<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Cali Fest 2025</title>
    <!-- Scripts base -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap');
        body { 
            font-family: 'Plus Jakarta Sans', sans-serif; 
            background-color: #000; 
            color: white; 
            margin: 0;
            overscroll-behavior-y: contain; /* Evita el bounce en iOS */
        }
        .loading-screen {
            position: fixed; inset: 0; background: black; display: flex; 
            flex-direction: column; align-items: center; justify-content: center; z-index: 100;
        }
        .spinner {
            width: 40px; height: 40px; border: 4px solid #1a1a1a; border-top-color: #deff9a;
            border-radius: 50%; animation: spin 1s linear infinite;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
        /* Eliminar scroll lateral */
        html, body { overflow-x: hidden; width: 100%; }
    </style>
</head>
<body>
    <div id="loading" class="loading-screen">
        <div class="spinner"></div>
        <p style="margin-top: 20px; color: #deff9a; font-weight: bold; font-size: 12px; letter-spacing: 2px;">CALI FEST 2025</p>
    </div>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Íconos SVG para no depender de librerías externas
        const Icon = ({ name }) => {
            const icons = {
                dumbbell: <path d="M6 15h12M6 9h12M22 9v6M2 9v6M18 5v14M6 5v14" />,
                run: <path d="M13 4v16M17 4v16M9 4v16M5 4v16" strokeDasharray="4 4" />, // Placeholder simple
                footprints: <path d="M4 16c0-3 2-5 2-5s2 2 2 5-2 5-2 5-2-2-2-5zM16 8c0-3 2-5 2-5s2 2 2 5-2 5-2 5-2-2-2-5z" />,
                calendar: (
                    <React.Fragment>
                        <rect x="3" y="4" width="18" height="18" rx="2" ry="2" />
                        <path d="M16 2v4M8 2v4M3 10h18" />
                    </React.Fragment>
                ),
                chart: <path d="M18 20V10M12 20V4M6 20v-6" />,
                plus: <path d="M12 5v14M5 12h14" />,
                check: <polyline points="20 6 9 17 4 12" />
            };
            return (
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round">
                    {icons[name] || <circle cx="12" cy="12" r="10" />}
                </svg>
            );
        };

        const DAYS = ['Lunes', 'Martes', 'Miércoles', 'Jueves', 'Viernes', 'Sábado', 'Domingo'];

        const getWorkoutForWeek = (day, week) => {
            const data = {
                'Lunes': { type: 'fuerza', title: 'Upper Body & Handstand', focus: 'Empuje y Tracción', exercises: [
                    { name: 'Pike Push-ups', target: `3 x ${8 + (week - 1)} reps` },
                    { name: 'Wall Walks / Wall Hold', target: `${45 + (week - 1) * 5} seg` },
                    { name: 'Fondos (Dips)', target: '3 x Fallo' },
                    { name: 'Remos Invertidos', target: '3 x 10 reps' },
                    { name: 'Rueda Abdominal', target: `3 x ${12 + (week - 1)} reps` }
                ]},
                'Martes': { type: 'running', title: 'Intervalos de Velocidad', focus: 'VO2 Max', tasks: [
                    { name: 'Calentamiento', target: '10 min Trote' },
                    { name: 'Series 800m', target: `${6 + (week > 2 ? 2 : 0)} reps` },
                    { name: 'Descanso', target: '2 min caminando' }
                ]},
                'Miércoles': { type: 'fuerza', title: 'Lower Body & Stability', focus: 'Piernas Ironman', exercises: [
                    { name: 'Zancada Búlgara', target: '3 x 12 p/p' },
                    { name: 'Puentes de Glúteo', target: '3 x 20 reps' },
                    { name: 'Elevación Talones', target: '3 x 30 reps' },
                    { name: 'Máquina de Abs', target: '3 x 15 reps' }
                ]},
                'Jueves': { type: 'running', title: 'Tempo Run', focus: 'Resistencia Aeróbica', tasks: [
                    { name: 'Distancia Objetivo', target: `${8 + (week - 1)} km` },
                    { name: 'Cadencia alta', target: '180 spm' }
                ]},
                'Viernes': { type: 'fuerza', title: 'Full Body & Core', focus: 'Técnica Handstand', exercises: [
                    { name: 'Práctica Handstand', target: `${15 + (week - 1) * 2} min` },
                    { name: 'Flexiones Diamante', target: '3 x Fallo' },
                    { name: 'Rueda Abdominal', target: '4 x 10 reps' }
                ]},
                'Sábado': { type: 'running', title: 'Long Run (Base Ironman)', focus: 'Resistencia Ultra', tasks: [
                    { name: 'Distancia Larga', target: `${15 + (week - 1) * 2} km` },
                    { name: 'Prueba de Nutrición', target: 'Hidratación/Geles' }
                ]},
                'Domingo': { type: 'rest', title: 'Descanso / Movilidad', focus: 'Recuperación', tasks: [
                    { name: 'Estiramiento Global', target: '15 min' },
                    { name: 'Movilidad Hombros', target: '10 min' }
                ]}
            };
            return data[day];
        };

        function App() {
            const [activeTab, setActiveTab] = useState('today'); 
            const [currentDayIndex, setCurrentDayIndex] = useState(0);
            const [week, setWeek] = useState(1);
            const [completedExercises, setCompletedExercises] = useState({});
            const [runStats, setRunStats] = useState({});
            const [showModal, setShowModal] = useState(false);
            const [note, setNote] = useState("");

            useEffect(() => {
                const today = new Date().getDay();
                setCurrentDayIndex(today === 0 ? 6 : today - 1);
                
                const savedWeek = localStorage.getItem('califest_week');
                const savedProgress = localStorage.getItem('califest_progress');
                const savedRuns = localStorage.getItem('califest_runs');
                
                if (savedWeek) setWeek(parseInt(savedWeek));
                if (savedProgress) setCompletedExercises(JSON.parse(savedProgress));
                if (savedRuns) setRunStats(JSON.parse(savedRuns));

                // Quitar pantalla de carga
                setTimeout(() => {
                    const loader = document.getElementById('loading');
                    if (loader) loader.style.display = 'none';
                }, 800);
            }, []);

            const toggleExercise = (name) => {
                const key = `W${week}-${DAYS[currentDayIndex]}-${name}`;
                const updated = { ...completedExercises, [key]: !completedExercises[key] };
                setCompletedExercises(updated);
                localStorage.setItem('califest_progress', JSON.stringify(updated));
            };

            const advanceWeek = () => {
                const nextWeek = week + 1;
                setWeek(nextWeek);
                localStorage.setItem('califest_week', nextWeek.toString());
                setActiveTab('today');
                window.scrollTo(0,0);
            };

            const handleRunInput = (field, val) => {
                const dayKey = `W${week}-${DAYS[currentDayIndex]}`;
                const updated = { ...runStats, [dayKey]: { ...runStats[dayKey], [field]: val } };
                setRunStats(updated);
                localStorage.setItem('califest_runs', JSON.stringify(updated));
            };

            const currentDayName = DAYS[currentDayIndex];
            const workout = getWorkoutForWeek(currentDayName, week);

            const calculateDayProgress = (dayName) => {
                const dayWorkout = getWorkoutForWeek(dayName, week);
                const dayItems = (dayWorkout.exercises || dayWorkout.tasks);
                const done = dayItems.filter(i => completedExercises[`W${week}-${dayName}-${i.name}`]).length;
                return { done, total: dayItems.length };
            };

            const calculateTotalProgress = () => {
                let total = 0, done = 0;
                DAYS.forEach(d => { const p = calculateDayProgress(d); total += p.total; done += p.done; });
                return total === 0 ? 0 : Math.round((done / total) * 100);
            };

            return (
                <div className="min-h-screen bg-black">
                    {/* Header estilo iOS */}
                    <header className="pt-12 pb-6 px-6 bg-neutral-900/90 border-b border-white/5 sticky top-0 z-30 backdrop-blur-2xl">
                        <div className="flex justify-between items-end mb-6">
                            <div>
                                <h1 className="text-3xl font-[900] text-[#deff9a] italic tracking-tighter leading-none">CALI FEST</h1>
                                <p className="text-[10px] text-neutral-500 font-bold uppercase tracking-[0.3em] mt-1">Semana {week}</p>
                            </div>
                            <div className="bg-[#deff9a] text-black px-3 py-1 rounded-full text-xs font-black">
                                {calculateTotalProgress()}%
                            </div>
                        </div>

                        {activeTab === 'today' && (
                            <div className="flex items-center justify-between bg-white/5 p-1 rounded-2xl border border-white/5">
                                <button onClick={() => setCurrentDayIndex(p => (p - 1 + 7) % 7)} className="p-3 active:scale-75 transition-transform"><Icon name="dumbbell" /></button>
                                <h2 className="text-xs font-black uppercase tracking-widest text-[#deff9a]">{currentDayName}</h2>
                                <button onClick={() => setCurrentDayIndex(p => (p + 1) % 7)} className="p-3 active:scale-75 transition-transform"><Icon name="footprints" /></button>
                            </div>
                        )}
                    </header>

                    <main className="p-5 max-w-md mx-auto">
                        {activeTab === 'today' ? (
                            <div className="space-y-6">
                                <div className="bg-neutral-900 rounded-[2.5rem] p-8 border border-white/5 shadow-2xl relative overflow-hidden">
                                    <div className="absolute top-0 right-0 p-8 opacity-5">
                                        <Icon name={workout.type === 'fuerza' ? 'dumbbell' : 'footprints'} />
                                    </div>
                                    <h3 className="text-2xl font-black uppercase italic leading-tight mb-2">{workout.title}</h3>
                                    <p className="text-[10px] text-neutral-500 font-bold uppercase tracking-widest mb-8">{workout.focus}</p>

                                    <div className="space-y-3">
                                        {(workout.exercises || workout.tasks).map((item, idx) => {
                                            const isDone = completedExercises[`W${week}-${currentDayName}-${item.name}`];
                                            return (
                                                <button key={idx} onClick={() => toggleExercise(item.name)} 
                                                    className={`w-full flex items-center gap-4 p-5 rounded-3xl border transition-all active:scale-95 ${isDone ? 'bg-neutral-800/30 border-transparent opacity-40' : 'bg-neutral-800/60 border-white/5 shadow-xl'}`}>
                                                    <div className={`${isDone ? 'text-[#deff9a]' : 'text-neutral-700'}`}>
                                                        <Icon name={isDone ? 'check' : 'plus'} />
                                                    </div>
                                                    <div className="text-left">
                                                        <p className={`text-sm font-bold ${isDone ? 'line-through' : ''}`}>{item.name}</p>
                                                        <p className="text-[10px] text-neutral-500 font-bold uppercase mt-1">{item.target}</p>
                                                    </div>
                                                </button>
                                            );
                                        })}
                                    </div>

                                    {workout.type === 'running' && (
                                        <div className="mt-10 pt-8 border-t border-white/5 grid grid-cols-2 gap-4">
                                            <div className="bg-black p-4 rounded-3xl border border-white/5">
                                                <label className="text-[8px] font-bold text-neutral-600 block mb-1 uppercase">Kilómetros</label>
                                                <input type="number" placeholder="0.0" value={runStats[`W${week}-${currentDayName}`]?.km || ''} onChange={e => handleRunInput('km', e.target.value)} className="bg-transparent w-full text-xl font-black text-[#deff9a] outline-none" />
                                            </div>
                                            <div className="bg-black p-4 rounded-3xl border border-white/5">
                                                <label className="text-[8px] font-bold text-neutral-600 block mb-1 uppercase">Minutos</label>
                                                <input type="number" placeholder="0" value={runStats[`W${week}-${currentDayName}`]?.min || ''} onChange={e => handleRunInput('min', e.target.value)} className="bg-transparent w-full text-xl font-black text-white outline-none" />
                                            </div>
                                        </div>
                                    )}
                                </div>
                            </div>
                        ) : (
                            <div className="space-y-4 animate-in fade-in slide-in-from-bottom-4 duration-500">
                                <h3 className="text-3xl font-black italic mb-6">PROGRESO</h3>
                                <div className="grid gap-3">
                                    {DAYS.map(day => {
                                        const { done, total } = calculateDayProgress(day);
                                        const isComp = done === total && total > 0;
                                        return (
                                            <div key={day} className={`p-6 rounded-[2rem] border flex justify-between items-center ${isComp ? 'bg-[#deff9a]/5 border-[#deff9a]/30' : 'bg-neutral-900 border-white/5'}`}>
                                                <div>
                                                    <p className={`text-xs font-black uppercase ${isComp ? 'text-[#deff9a]' : 'text-neutral-500'}`}>{day}</p>
                                                    <p className="text-[9px] text-neutral-700 font-bold">{getWorkoutForWeek(day, week).title}</p>
                                                </div>
                                                <div className="flex items-center gap-3">
                                                    <span className="text-xs font-black italic">{done}/{total}</span>
                                                    {isComp && <Icon name="check" />}
                                                </div>
                                            </div>
                                        );
                                    })}
                                </div>
                                <button onClick={advanceWeek} disabled={calculateTotalProgress() < 80} 
                                    className={`w-full py-6 rounded-[2.5rem] font-black italic text-lg mt-8 transition-all active:scale-95 ${calculateTotalProgress() >= 80 ? 'bg-[#deff9a] text-black shadow-2xl shadow-[#deff9a]/20' : 'bg-neutral-800 text-neutral-600 opacity-50'}`}>
                                    SIGUIENTE SEMANA
                                </button>
                            </div>
                        )}
                    </main>

                    {/* Bottom Nav */}
                    <nav className="fixed bottom-0 left-0 right-0 bg-neutral-950/90 backdrop-blur-3xl border-t border-white/5 px-10 pt-6 pb-10 flex justify-around items-center z-40">
                        <button onClick={() => setActiveTab('today')} className={`p-2 transition-all ${activeTab === 'today' ? 'text-[#deff9a] scale-125' : 'text-neutral-700'}`}>
                            <Icon name="calendar" />
                        </button>
                        <button onClick={() => setShowModal(true)} className="w-16 h-16 bg-[#deff9a] rounded-full flex items-center justify-center -mt-20 border-[6px] border-black text-black active:scale-75 transition-transform shadow-2xl shadow-[#deff9a]/20">
                            <Icon name="plus" />
                        </button>
                        <button onClick={() => setActiveTab('progress')} className={`p-2 transition-all ${activeTab === 'progress' ? 'text-[#deff9a] scale-125' : 'text-neutral-700'}`}>
                            <Icon name="chart" />
                        </button>
                    </nav>

                    {/* Modal */}
                    {showModal && (
                        <div className="fixed inset-0 z-50 flex items-center justify-center p-6 bg-black/95 backdrop-blur-xl animate-in zoom-in-95 duration-200">
                            <div className="bg-neutral-900 w-full max-w-sm rounded-[3rem] p-10 border border-white/10 relative">
                                <button onClick={() => setShowModal(false)} className="absolute top-6 right-6 text-neutral-500"><Icon name="plus" /></button>
                                <h3 className="text-2xl font-black italic text-[#deff9a] mb-8 uppercase tracking-tighter">Log Personal</h3>
                                <textarea className="w-full bg-black rounded-[2rem] p-6 text-sm border border-white/5 h-40 outline-none mb-6 focus:border-[#deff9a]/30 transition-all" placeholder="¿Qué rompiste hoy?" value={note} onChange={e => setNote(e.target.value)} />
                                <button onClick={() => { setShowModal(false); setNote(""); }} className="w-full bg-[#deff9a] text-black font-black py-5 rounded-[2rem] shadow-xl">GUARDAR RÉCORD</button>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
